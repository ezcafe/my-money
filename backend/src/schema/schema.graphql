"""
My Money GraphQL Schema
"""

scalar DateTime
scalar Decimal
scalar Upload

enum SortOrder {
  asc
  desc
}

enum TransactionOrderBy {
  date
  value
  category
  account
  payee
}

enum CategoryType {
  INCOME
  EXPENSE
}

input TransactionOrderInput {
  field: TransactionOrderBy!
  direction: SortOrder!
}

type Query {
  """
  Get current user information
  """
  me: User!

  """
  Get all accounts for current user
  """
  accounts: [Account!]!

  """
  Get account by ID
  """
  account(id: ID!): Account

  """
  Get account balance (calculated)
  """
  accountBalance(accountId: ID!): Decimal!

  """
  Get transactions with pagination
  """
  transactions(
    accountId: ID
    categoryId: ID
    payeeId: ID
    skip: Int
    take: Int
    first: Int
    after: String
    orderBy: TransactionOrderInput
    note: String
  ): TransactionConnection!

  """
  Get last 30 transactions for home page
  """
  recentTransactions(limit: Int = 30, orderBy: TransactionOrderInput): [Transaction!]!

  """
  Get transaction by ID
  """
  transaction(id: ID!): Transaction

  """
  Get all categories
  """
  categories: [Category!]!

  """
  Get category by ID
  """
  category(id: ID!): Category

  """
  Get all payees
  """
  payees: [Payee!]!

  """
  Get payee by ID
  """
  payee(id: ID!): Payee

  """
  Get user preferences
  """
  preferences: UserPreferences

  """
  Get recurring transactions
  """
  recurringTransactions: [RecurringTransaction!]!

  """
  Get report transactions with filters
  """
  reportTransactions(
    accountIds: [ID!]
    categoryIds: [ID!]
    payeeIds: [ID!]
    startDate: DateTime
    endDate: DateTime
    note: String
    orderBy: TransactionOrderInput
    skip: Int
    take: Int
  ): ReportTransactionConnection!

  """
  Get top 5 most used transaction values from recent transactions
  """
  topUsedValues(days: Int = 90): [TopUsedValue!]!

  """
  Export all user data for CSV export
  """
  exportData: ExportData!
}

type Mutation {
  """
  Create a new account
  """
  createAccount(input: CreateAccountInput!): Account!

  """
  Update account
  """
  updateAccount(id: ID!, input: UpdateAccountInput!): Account!

  """
  Delete account (cannot delete default account)
  """
  deleteAccount(id: ID!): Boolean!

  """
  Create a transaction
  """
  createTransaction(input: CreateTransactionInput!): Transaction!

  """
  Update transaction
  """
  updateTransaction(id: ID!, input: UpdateTransactionInput!): Transaction!

  """
  Delete transaction
  """
  deleteTransaction(id: ID!): Boolean!

  """
  Create category
  """
  createCategory(input: CreateCategoryInput!): Category!

  """
  Update category
  """
  updateCategory(id: ID!, input: UpdateCategoryInput!): Category!

  """
  Delete category
  """
  deleteCategory(id: ID!): Boolean!

  """
  Create payee
  """
  createPayee(input: CreatePayeeInput!): Payee!

  """
  Update payee
  """
  updatePayee(id: ID!, input: UpdatePayeeInput!): Payee!

  """
  Delete payee
  """
  deletePayee(id: ID!): Boolean!

  """
  Update user preferences
  """
  updatePreferences(input: UpdatePreferencesInput!): UserPreferences!

  """
  Create recurring transaction
  """
  createRecurringTransaction(input: CreateRecurringTransactionInput!): RecurringTransaction!

  """
  Update recurring transaction
  """
  updateRecurringTransaction(id: ID!, input: UpdateRecurringTransactionInput!): RecurringTransaction!

  """
  Delete recurring transaction
  """
  deleteRecurringTransaction(id: ID!): Boolean!

  """
  Upload PDF for import
  """
  uploadPDF(file: Upload!): PDFUploadResult!

  """
  Match imported transaction
  """
  matchImportedTransaction(importedId: ID!, transactionId: ID!): ImportedTransaction!

  """
  Import CSV file and merge data
  """
  importCSV(file: Upload!, entityType: String!): ImportResult!

  """
  Reset all user data except default account, category, and payee
  """
  resetData: Boolean!
}

type User {
  id: ID!
  oidcSubject: String!
  email: String!
  createdAt: DateTime!
  updatedAt: DateTime!
}

type Account {
  id: ID!
  name: String!
  initBalance: Decimal!
  isDefault: Boolean!
  userId: ID!
  createdAt: DateTime!
  updatedAt: DateTime!
  balance: Decimal!
}

type Transaction {
  id: ID!
  value: Decimal!
  date: DateTime!
  accountId: ID!
  account: Account
  categoryId: ID
  category: Category
  payeeId: ID
  payee: Payee
  note: String
  userId: ID!
  createdAt: DateTime!
  updatedAt: DateTime!
}

type TransactionConnection {
  items: [Transaction!]!
  totalCount: Int!
  hasMore: Boolean!
  nextCursor: String
}

type Category {
  id: ID!
  name: String!
  type: CategoryType!
  isDefault: Boolean!
  userId: ID
  createdAt: DateTime!
  updatedAt: DateTime!
}

type Payee {
  id: ID!
  name: String!
  isDefault: Boolean!
  userId: ID
  createdAt: DateTime!
  updatedAt: DateTime!
}

type UserPreferences {
  id: ID!
  userId: ID!
  currency: String!
  useThousandSeparator: Boolean!
  createdAt: DateTime!
  updatedAt: DateTime!
}

type RecurringTransaction {
  id: ID!
  cronExpression: String!
  value: Decimal!
  accountId: ID!
  account: Account
  categoryId: ID
  category: Category
  payeeId: ID
  payee: Payee
  note: String
  nextRunDate: DateTime!
  userId: ID!
  createdAt: DateTime!
  updatedAt: DateTime!
}

type ImportedTransaction {
  id: ID!
  rawDate: String!
  rawDescription: String!
  rawDebit: Decimal
  rawCredit: Decimal
  matched: Boolean!
  transactionId: ID
  transaction: Transaction
  userId: ID!
  createdAt: DateTime!
  updatedAt: DateTime!
}

type PDFUploadResult {
  success: Boolean!
  importedCount: Int!
  importedTransactions: [ImportedTransaction!]!
}

type ReportTransactionConnection {
  items: [Transaction!]!
  totalCount: Int!
  totalAmount: Decimal!
}

type TopUsedValue {
  value: String!
  count: Int!
}

type ExportData {
  accounts: [Account!]!
  categories: [Category!]!
  payees: [Payee!]!
  transactions: [Transaction!]!
  recurringTransactions: [RecurringTransaction!]!
  preferences: UserPreferences
}

type ImportResult {
  success: Boolean!
  created: Int!
  updated: Int!
  errors: [String!]!
}

input CreateAccountInput {
  name: String!
  initBalance: Decimal
}

input UpdateAccountInput {
  name: String
  initBalance: Decimal
}

input CreateTransactionInput {
  value: Decimal!
  date: DateTime
  accountId: ID!
  categoryId: ID
  payeeId: ID
  note: String
}

input UpdateTransactionInput {
  value: Decimal
  date: DateTime
  accountId: ID
  categoryId: ID
  payeeId: ID
  note: String
}

input CreateCategoryInput {
  name: String!
  type: CategoryType!
}

input UpdateCategoryInput {
  name: String
  type: CategoryType
}

input CreatePayeeInput {
  name: String!
}

input UpdatePayeeInput {
  name: String
}

input UpdatePreferencesInput {
  currency: String
  useThousandSeparator: Boolean
}

input CreateRecurringTransactionInput {
  cronExpression: String!
  value: Decimal!
  accountId: ID!
  categoryId: ID
  payeeId: ID
  note: String
  nextRunDate: DateTime!
}

input UpdateRecurringTransactionInput {
  cronExpression: String
  value: Decimal
  accountId: ID
  categoryId: ID
  payeeId: ID
  note: String
  nextRunDate: DateTime
}







